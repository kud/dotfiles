#! /usr/bin/env zsh

source $MY/core/helper

startFreshNormal() {
  /Applications/Firefox.app/Contents/MacOS/firefox-bin -p fresh &> /dev/null &
}

startFreshNightly() {
  /Applications/FirefoxNightly.app/Contents/MacOS/firefox-bin -p fresh &> /dev/null &
}

makeDefaultBackup() {
  rm -rf /opt/homebrew-cask/Caskroom/firefox-nightly/FirefoxNightlyBackup.app
  cp -R $(readlink /Applications/FirefoxNightly.app) /opt/homebrew-cask/Caskroom/firefox-nightly/FirefoxNightlyBackup.app
}

makeStableBackup() {
  rm -rf /opt/homebrew-cask/Caskroom/firefox-nightly/FirefoxNightlyStable.app
  cp -R /opt/homebrew-cask/Caskroom/firefox-nightly/FirefoxNightlyBackup.app /opt/homebrew-cask/Caskroom/firefox-nightly/FirefoxNightlyStable.app
}

startDefaultBackup() {
  /opt/homebrew-cask/Caskroom/firefox-nightly/FirefoxNightlyBackup.app/Contents/MacOS/firefox-bin &> /dev/null &
}

startStableBackup() {
  /opt/homebrew-cask/Caskroom/firefox-nightly/FirefoxNightlyStable.app/Contents/MacOS/firefox-bin &> /dev/null &
}


if [[ $# -eq 0 ]]; then
  $0 --help
else

  case "$1" in
    start-fresh)
      case "$2" in
        normal)
          startFreshNormal
        ;;
        nightly)
          startFreshNightly
        ;;
        *)
          echo 'What did you say?'
        ;;
      esac
    ;;
    make-backup)
      case "$2" in
        default)
          makeDefaultBackup
        ;;
        stable)
          makeStableBackup
        ;;
        *)
          echo 'What did you say?'
        ;;
      esac
    ;;
    start-backup)
      case "$2" in
        default)
          startDefaultBackup
        ;;
        stable)
          startStableBackup
        ;;
        *)
          echo 'What did you say?'
        ;;
      esac
    ;;
    --help)
        echo_space
        printf "Usage:"
        echo_spacex2
        printf "    ${COLOUR_CYAN}firefox-manager${COLOUR_RESET} [<command>|--help]"
        echo_spacex3
        printf "Commands:"
        echo_spacex2
        printf "    start-fresh [normal|nightly]         ${COLOUR_BLACK}Start a fresh profile with Firefox${COLOUR_RESET}"
        echo_space
        printf "    make-backup [default|stable]   ${COLOUR_BLACK}Make a backup of Firefox Nightly${COLOUR_RESET}"
        echo_space
        printf "    start-backup [default|stable]    ${COLOUR_BLACK}Start the backup of Firefox Nightly${COLOUR_RESET}"
        echo_spacex2
    ;;
    *)
      echo 'What did you say?'
    ;;
  esac

fi
